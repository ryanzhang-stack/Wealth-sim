<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è´¢å¯Œè‡ªç”±æ¨æ¼”æ²™ç›˜ | Khalidåœ¨è·¯ä¸Š</title>
    <meta name="description" content="åŸºäºåŠ¨æ€è–ªèµ„å¢é•¿ä¸å¤åˆ©æ•ˆåº”çš„èµ„äº§æ¨æ¼”å·¥å…·ï¼Œé‡åŒ–è´¢åŠ¡æƒ…å†µï¼ŒåŠ©åŠ›è´¢åŠ¡è‡ªç”±ã€‚">
    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            /* V21.0 ç”Ÿæ´»å®¶é…è‰² */
            --primary-color: #8b5cf6;
            --primary-dark: #7c3aed;
            --accent-color: #f43f5e;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --bg-gradient: linear-gradient(180deg, #fdf4ff 0%, #ffffff 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --btn-gradient: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
            --shadow-soft: 0 10px 40px -10px rgba(139, 92, 246, 0.15);
            
            /* çŠ¶æ€è‰² */
            --input-bg: #f8fafc;
            --input-border: #e2e8f0;
            --input-tag-bg: #e0e7ff;
            --input-tag-text: #4338ca;
            
            --result-bg: #fff1f2;         
            --result-border: #f43f5e;     
            --result-text: #be123c;       
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg-gradient); color: var(--text-main); margin: 0; padding: 20px 15px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .container {
            background: var(--card-bg); width: 100%; max-width: 800px; padding: 30px 25px;
            border-radius: 24px; box-shadow: var(--shadow-soft); margin-bottom: 30px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.8); transition: all 0.3s ease;
        }
        
        /* å¤´éƒ¨ */
        .intro-box { text-align: center; margin-bottom: 25px; }
        .emoji-header { font-size: 40px; margin-bottom: 10px; display: block; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        
        h1 { 
            font-size: 22px; margin: 0 0 10px 0; color: #4c1d95; font-weight: 800; 
            background: -webkit-linear-gradient(45deg, #8b5cf6, #f43f5e);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .intro-text { font-size: 13px; color: var(--text-light); line-height: 1.6; max-width: 90%; margin: 0 auto; }

        .guide-box {
            background: #f5f3ff; border-radius: 16px; padding: 15px; margin-bottom: 25px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #e9d5ff;
        }
        .guide-step { display: flex; flex-direction: column; align-items: center; gap: 6px; flex: 1; text-align: center; }
        .guide-icon { font-size: 20px; background: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .guide-text { font-size: 11px; color: #5b21b6; font-weight: 600; }
        .guide-line { width: 30px; height: 2px; background: #ddd6fe; border-radius: 2px; }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-label { font-size: 15px; font-weight: 700; color: #4b5563; display: flex; align-items: center; gap: 6px; }
        
        .mode-switch {
            position: relative; width: 140px; height: 40px; background: #f3f4f6;
            border-radius: 20px; display: flex; align-items: center; padding: 4px;
            cursor: pointer; user-select: none; box-sizing: border-box;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .switch-slider {
            position: absolute; left: 4px; top: 4px; width: 66px; height: 32px;
            background: white; border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }
        .mode-label {
            flex: 1; text-align: center; font-size: 12px; font-weight: 700; color: #9ca3af;
            z-index: 2; transition: color 0.3s; line-height: 32px;
        }
        .container.pro-mode .switch-slider { transform: translateX(66px); background: linear-gradient(135deg, #8b5cf6, #a78bfa); }
        .container.pro-mode .mode-label.pro-text { color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .container.pro-mode .mode-switch { background: #ede9fe; }
        .container.pro-mode { border-top: 4px solid #8b5cf6; }

        /* Tabs */
        .tabs { display: flex; margin-bottom: 25px; background: #f9fafb; border-radius: 16px; padding: 5px; gap: 5px; border: 1px solid #f3f4f6; }
        .tab { 
            flex: 1; text-align: center; padding: 8px 4px; cursor: pointer; border-radius: 12px; 
            transition: all 0.2s; color: #6b7280; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .tab-title { font-size: 13px; font-weight: 700; line-height: 1.2; }
        .tab-desc { font-size: 9px; font-weight: 400; opacity: 0.8; margin-top: 2px; transform: scale(0.95); white-space: nowrap; }
        
        .tab.active { background: white; color: var(--primary-color); box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        .container.pro-mode .tab.active { color: #7c3aed; }

        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        @media (max-width: 700px) { .main-grid { grid-template-columns: 1fr; gap: 20px; } }
        
        .section-title { 
            font-size: 13px; font-weight: 700; color: #6b7280; margin-bottom: 15px; 
            border-bottom: 2px solid #f3f4f6; padding-bottom: 8px; display: flex; justify-content: space-between; 
        }
        
        /* åŸºç¡€è¡¨å•æ ·å¼ */
        .form-group { 
            margin-bottom: 15px; border-radius: 14px; 
            padding: 8px; border: 2px solid transparent; 
            transition: all 0.2s ease;
        }
        label { display: flex; align-items: center; justify-content: space-between; font-size: 13px; color: #4b5563; margin-bottom: 6px; font-weight: 600; }
        
        /* 1. è“è‰²ï¼šéœ€è¦è¾“å…¥ */
        .form-group.input-needed label::after {
            content: "âœ è¯·è¾“å…¥"; font-size: 9px; background: var(--input-tag-bg); color: var(--input-tag-text);
            padding: 2px 6px; border-radius: 6px; font-weight: 600;
        }

        /* 2. ç²‰è‰²ï¼šå¾…è®¡ç®—ç»“æœ (å¼ºåŠ›ç»Ÿä¸€) */
        .form-group.target-highlight {
            background-color: var(--result-bg) !important;
            border-color: var(--result-border) !important;
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.15) !important;
            animation: breathe 3s infinite ease-in-out;
        }
        @keyframes breathe { 
            0%, 100% { box-shadow: 0 2px 5px rgba(244, 63, 94, 0.1); border-color: rgba(244, 63, 94, 0.5); } 
            50% { box-shadow: 0 6px 15px rgba(244, 63, 94, 0.25); border-color: rgba(244, 63, 94, 1); } 
        }

        .form-group.target-highlight label { color: var(--result-text) !important; }
        .form-group.target-highlight label::after {
            content: "âœ¨ æ™ºèƒ½è®¡ç®—"; font-size: 10px; background: white; color: var(--result-text);
            padding: 2px 8px; border-radius: 10px; font-weight: 800; border: 1px solid #fecdd3;
        }

        /* è¾“å…¥æ¡†åŸºç¡€ */
        input {
            width: 100%; padding: 12px; border: 2px solid #f3f4f6; border-radius: 12px; font-size: 15px;
            box-sizing: border-box; transition: all 0.2s; font-family: monospace; background: var(--input-bg);
            color: #1f2937;
        }
        input:focus { outline: none; border-color: #a78bfa; background: white; box-shadow: 0 0 0 4px #ede9fe; }

        /* ç»Ÿä¸€çš„é«˜äº®è¾“å…¥æ¡†æ ·å¼ (!important è¦†ç›–æ‰€æœ‰) */
        .form-group.target-highlight input {
            background-color: transparent !important;
            border: none !important;
            border-bottom: 2px dashed rgba(244, 63, 94, 0.3) !important;
            border-radius: 0 !important;
            color: var(--result-text) !important;
            font-weight: 800 !important;
            font-size: 20px !important; 
            text-align: center !important;
            box-shadow: none !important;
            opacity: 1 !important;
            -webkit-text-fill-color: var(--result-text) !important;
            padding: 5px 0 !important;
            cursor: default !important;
        }
        .form-group.target-highlight input::placeholder {
            color: rgba(190, 18, 60, 0.4) !important; 
            font-weight: 400 !important; 
            font-size: 14px !important;
            -webkit-text-fill-color: rgba(190, 18, 60, 0.4) !important;
        }

        /* éšè—å…ƒç´  */
        .pro-only { display: none; }
        .container.pro-mode .pro-only { display: block; animation: slideDown 0.4s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .growth-inputs { background: #fff1f2; padding: 15px; border-radius: 16px; border: 1px solid #ffe4e6; margin-bottom: 15px; }
        .container.pro-mode .growth-inputs { background: #f5f3ff; border-color: #ddd6fe; }
        
        .event-row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        .btn-add { 
            background: white; border: 2px dashed #d1d5db; color: #6b7280; width: 100%; padding: 10px; 
            border-radius: 12px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s;
        }
        .btn-add:hover { border-color: var(--primary-color); color: var(--primary-color); background: #f5f3ff; }
        .btn-del { border:none; background:white; color:#ef4444; width:24px; height:24px; border-radius:50%; box-shadow:0 2px 4px rgba(0,0,0,0.1); cursor:pointer; display:flex; align-items:center; justify-content:center; }

        .btn-calc { 
            width: 100%; background: var(--btn-gradient); color: white; padding: 16px; border: none; 
            border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 15px; 
            box-shadow: 0 8px 20px -5px rgba(139, 92, 246, 0.4);
            transition: transform 0.1s, box-shadow 0.2s; 
        }
        .btn-calc:active { transform: scale(0.98); box-shadow: 0 4px 10px -2px rgba(139, 92, 246, 0.4); }

        .result-panel { 
            background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 25px; 
            border-radius: 20px; margin-top: 30px; 
            display: flex; justify-content: space-between; align-items: flex-start;
            position: relative; overflow: hidden;
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
        }
        .result-panel::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            transform: rotate(30deg); pointer-events: none;
        }
        .result-item { text-align: center; flex: 1; display: flex; flex-direction: column; align-items: center; z-index: 1; }
        .result-item label { color: rgba(255,255,255,0.8); margin-bottom: 8px; font-size: 12px; letter-spacing: 0.5px; }
        .result-item .value { font-size: 26px; font-weight: 800; line-height: 1.1; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .real-val-group { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .green-text { color: #a7f3d0; }

        .cpi-control-box {
            background: rgba(255,255,255,0.15); border-radius: 20px; padding: 3px;
            display: flex; margin-top: 10px; width: fit-content; backdrop-filter: blur(4px);
        }
        .cpi-btn {
            background: transparent; border: none; color: rgba(255,255,255,0.7);
            font-size: 10px; padding: 5px 10px; cursor: pointer; border-radius: 16px;
            transition: all 0.2s; font-weight: 600;
        }
        .cpi-btn.active.low { background: #d1fae5; color: #065f46; }
        .cpi-btn.active.med { background: #dbeafe; color: #1e40af; }
        .cpi-btn.active.high { background: #fee2e2; color: #991b1b; }

        .achievement-box {
            background: #fffbeb; border: 1px solid #fcd34d; border-left: 4px solid #f59e0b;
            padding: 20px; margin-top: 25px; border-radius: 12px; display: none;
            position: relative; overflow: hidden;
        }
        .achievement-box::after { content: 'ğŸ†'; position: absolute; right: -10px; bottom: -10px; font-size: 80px; opacity: 0.1; transform: rotate(-20deg); }
        .achievement-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .achievement-badge { background: #f59e0b; color: white; font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 12px; }
        .achievement-title { font-size: 18px; font-weight: 800; color: #92400e; }
        .achievement-text { font-size: 14px; color: #b45309; line-height: 1.6; }
        
        .chart-box { margin-top: 30px; height: 280px; position: relative; }

        .glossary-box {
            margin-top: 30px; padding-top: 25px; border-top: 1px dashed #e5e7eb;
        }
        .glossary-title { font-size: 14px; font-weight: 700; color: #374151; margin-bottom: 15px; display: flex; align-items: center; gap: 6px; }
        .glossary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 600px) { .glossary-grid { grid-template-columns: 1fr; gap: 15px; } }
        .glossary-item { font-size: 12px; color: #6b7280; line-height: 1.5; background: #f9fafb; padding: 10px; border-radius: 10px; }
        .glossary-item b { color: var(--primary-dark); display: block; margin-bottom: 2px; }
        .ref-val { color: #f43f5e; font-size: 11px; display: block; margin-top: 4px; font-weight: 500; }

        .action-bar { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        .btn-reset { 
            background: white; border: 1px solid #e5e7eb; color: #94a3b8; 
            font-size: 13px; padding: 12px 24px; border-radius: 24px; cursor: pointer; transition: all 0.2s;
        }
        .btn-reset:hover { border-color: #f43f5e; color: #f43f5e; }
        
        .btn-share-hero {
            background: #1f2937; color: white; border: none; font-size: 13px; font-weight: 600;
            padding: 12px 24px; border-radius: 24px; cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 6px;
            transition: transform 0.2s;
        }
        .btn-share-hero:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }

        .footer { text-align: center; font-size: 12px; color: #9ca3af; margin-top: 40px; line-height: 1.8; padding-bottom: 40px; }
        .footer a { color: var(--primary-color); text-decoration: none; border-bottom: 1px dashed #cbd5e1; padding-bottom: 2px; }
        
        #lite-placeholder { text-align: center; color: #d1d5db; font-size: 13px; padding: 30px; border: 2px dashed #e5e7eb; border-radius: 16px; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; background: #f9fafb; }
    </style>
</head>
<body>

<div class="container" id="appContainer">
    <div class="intro-box">
        <span class="emoji-header">ğŸ”®</span>
        <h1>è´¢å¯Œè‡ªç”±æ¨æ¼”æ²™ç›˜</h1>
        <p class="intro-text">æ‹’ç»çº¿æ€§æ€ç»´ï¼Œå¼€å¯ä¸Šå¸è§†è§’ã€‚<br>ç”¨ç†æ€§é‡‘èæ¨¡å‹ï¼Œæ¨æ¼”ä½ æœªæ¥çš„æ— é™å¯èƒ½ã€‚</p>
    </div>
    
    <div class="guide-box">
        <div class="guide-step">
            <div class="guide-icon">ğŸ¯</div>
            <div class="guide-text">è®¾å®šç›®æ ‡</div>
        </div>
        <div class="guide-line"></div>
        <div class="guide-step">
            <div class="guide-icon">ğŸ“</div>
            <div class="guide-text">è¾“å…¥è–ªèµ„</div>
        </div>
        <div class="guide-line"></div>
        <div class="guide-step">
            <div class="guide-icon">ğŸ”“</div>
            <div class="guide-text">è§£é”æˆå°±</div>
        </div>
    </div>

    <div class="header-row">
        <span class="section-label">âœ¨ æ¨æ¼”æ¨¡å¼</span>
        <div class="mode-switch" onclick="toggleMode()">
            <div class="switch-slider"></div>
            <div class="mode-label">å°ç™½æ¨¡å¼</div>
            <div class="mode-label pro-text">Pro ä¸“å®¶</div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab active" data-target="fv" onclick="switchTab('fv')">
            <span class="tab-title">ç®—å­˜æ¬¾</span>
            <span class="tab-desc">æœªæ¥æœ‰å¤šå°‘é’±</span>
        </div>
        <div class="tab" data-target="pmt" onclick="switchTab('pmt')">
            <span class="tab-title">ç®—æŠ•å…¥</span>
            <span class="tab-desc">æ¯æœˆè¦å­˜å¤šå°‘</span>
        </div>
        <div class="tab" data-target="pv" onclick="switchTab('pv')">
            <span class="tab-title">ç®—æœ¬é‡‘</span>
            <span class="tab-desc">ç°åœ¨è¦æœ‰å‡ ä¸‡</span>
        </div>
        <div class="tab" data-target="years" onclick="switchTab('years')">
            <span class="tab-title">ç®—æ—¶é—´</span>
            <span class="tab-desc">è¿˜è¦å¥‹æ–—å¤šä¹…</span>
        </div>
    </div>

    <div class="main-grid">
        <div>
            <div class="section-title">ğŸ“Š åŸºç¡€å‚æ•°</div>
            <div class="form-group" id="grp_pv"><label>ğŸ’° ç°æœ‰èµ„é‡‘ (æœ¬é‡‘)</label><input type="number" id="pv" placeholder="100000"></div>
            <div class="form-group" id="grp_fv"><label>ğŸ ç›®æ ‡é‡‘é¢</label><input type="number" id="target_fv" placeholder="20000000"></div>
            
            <div id="simple_pmt_box" class="form-group" id="grp_simple_pmt"><label>ğŸ“¥ æ¯æœˆèƒ½å­˜å¤šå°‘é’±</label><input type="number" id="simple_pmt" placeholder="2000"></div>
            
            <div id="pro_cashflow_box" style="display:none;">
                <div class="form-group"><label style="color:var(--primary-color)">ğŸ’µ æœˆæ”¶å…¥ (ç¨å)</label><input type="number" id="income" placeholder="3000"></div>
                <div class="form-group"><label style="color:var(--accent-color)">ğŸ’¸ æœˆæ”¯å‡º (å¼€é”€)</label><input type="number" id="expense" placeholder="1000"></div>
            </div>
            
            <div class="form-group" id="grp_solved_pmt" style="display:none;">
                <label>ğŸ‘‰ å»ºè®®æ¯æœˆå­˜å…¥</label>
                <input type="text" id="solved_pmt" value="âœ¨ å¾…è®¡ç®—..." disabled>
            </div>

            <div class="form-group"><label>ğŸ“ˆ å¹´åŒ–ç†è´¢æ”¶ç›Š (%)</label><input type="number" id="rate" placeholder="5"></div>
            <div class="form-group" id="grp_years"><label>â³ å¥‹æ–—æ—¶é•¿ (å¹´)</label><input type="number" id="years" placeholder="15"></div>
        </div>

        <div class="pro-only">
            <div class="section-title">ğŸš€ åŠ¨æ€å¢é•¿ (Pro)</div>
            <div class="growth-inputs">
                <div class="form-group"><label style="color:var(--primary-color)">ğŸš€ å·¥èµ„å¹´æ¶¨å¹… (%)</label><input type="number" id="inc_growth" placeholder="10"></div>
                <div class="form-group"><label style="color:var(--accent-color)">ğŸ¥¬ å¼€é”€æ¶¨å¹… (%)</label><input type="number" id="exp_growth" placeholder="3"></div>
            </div>
            <div class="section-title">ğŸš© äººç”Ÿå¤§é¢æ”¶æ”¯</div>
            <div id="eventContainer" class="event-list"></div>
            <button class="btn-add" onclick="addEventRow()">+ æ·»åŠ èŠ‚ç‚¹ (å¦‚: è´­è½¦/ç¤¼ç‰©/å‰¯ä¸š)</button>
        </div>
        
        <div id="lite-placeholder">
            <div style="font-size:40px; margin-bottom:15px; opacity:0.5;">ğŸ¦„</div>
            <div style="font-weight:600; color:#9ca3af;">å¼€å¯ Pro æ¨¡å¼</div>
            <div style="font-size:12px; margin-top:5px;">è§£é”å·¥èµ„æ¶¨å¹…ä¸äººç”Ÿäº‹ä»¶æ¨¡æ‹Ÿ</div>
        </div>
    </div>

    <button class="btn-calc" onclick="runCalculation()">å¼€å§‹æ¨æ¼”æœªæ¥</button>

    <div class="result-panel">
        <div class="result-item">
            <label id="resLabel1">æœŸæœ«åä¹‰èµ„äº§</label>
            <div class="value" id="resValue1">--</div>
        </div>
        <div class="result-item" style="border-left:1px solid rgba(255,255,255,0.2)">
            <label id="resLabel2" style="color:#a7f3d0">å®é™…è´­ä¹°åŠ› (æŠ˜ç°)</label>
            <div class="real-val-group">
                <div class="value green-text" id="resValue2">--</div>
                <div class="cpi-control-box">
                    <button class="cpi-btn low active" id="cpiLow" onclick="setCPI(0.5, 'low')">ä½0.5%</button>
                    <button class="cpi-btn med" id="cpiMed" onclick="setCPI(2.5, 'med')">ä¸­2.5%</button>
                    <button class="cpi-btn high" id="cpiHigh" onclick="setCPI(5.0, 'high')">é«˜5.0%</button>
                </div>
            </div>
        </div>
    </div>

    <div class="achievement-box" id="achievementBox">
        <div class="achievement-header"><div class="achievement-badge">ğŸ† è§£é”æˆå°±</div><div class="achievement-title" id="achTitle">--</div></div>
        <div class="achievement-text" id="achText">è¯·è¿›è¡Œè®¡ç®—...</div>
    </div>

    <div class="chart-box"><canvas id="simChart"></canvas></div>
    
    <div class="glossary-box">
        <div class="glossary-title">ğŸ“– æŒ‡æ ‡å«ä¹‰ä¸å‚è€ƒ</div>
        <div class="glossary-grid">
            <div class="glossary-item">
                <b>å¹´åŒ–æ”¶ç›Š (%)</b>ç†è´¢äº§å“çš„å¹³å‡å¹´å›æŠ¥ç‡ã€‚
                <span class="ref-val">å‚è€ƒ: ä½™é¢å®~1-2%, å€ºåˆ¸åŸºé‡‘~2-4%</span>
            </div>
            <div class="glossary-item">
                <b>å·¥èµ„å¹´æ¶¨å¹… (%)</b>Proæ¨¡å¼ä¸‹ï¼Œæ¯å¹´è–ªèµ„å¢é•¿çš„é€Ÿåº¦ã€‚
                <span class="ref-val">å‚è€ƒ: èŒåœºåˆæœŸ~10-20%, ç¨³å®šæœŸ~3-5%</span>
            </div>
            <div class="glossary-item">
                <b>å¼€é”€æ¶¨å¹… (%)</b>ç”Ÿæ´»æˆæœ¬æå‡é€Ÿåº¦ (å«é€šèƒ€+æ¶ˆè´¹å‡çº§)ã€‚
                <span class="ref-val">å‚è€ƒ: 3% (ä¿å®ˆ), 5% (é«˜é€šèƒ€)</span>
            </div>
            <div class="glossary-item">
                <b>å®é™…è´­ä¹°åŠ›</b>æ‰£é™¤é€šèƒ€åï¼Œè¿™ç¬”é’±ç›¸å½“äºä»Šå¤©çš„ä»·å€¼ã€‚
                <span class="ref-val">é€»è¾‘: é¿å…"è´§å¸å¹»è§‰"ï¼Œåæ˜ çœŸå®ç”Ÿæ´»æ°´å¹³</span>
            </div>
        </div>
    </div>

    <div class="action-bar">
        <button class="btn-reset" onclick="clearData()">ğŸ—‘ï¸ é‡ç½®</button>
        <button class="btn-share-hero" onclick="copyReport()">ğŸ“‹ å¤åˆ¶è¯¦ç»†æˆå°±æˆ˜æŠ¥</button>
    </div>
</div>

<div class="footer">
    <p>Designed by <b>Khalidåœ¨è·¯ä¸Š</b> | ä¸€ä¸ªè„‘æ´å¾ˆå¤§çš„è·¨å¢ƒé‡‘èä»ä¸šè€…</p>
    <p>å…³æ³¨å°çº¢ä¹¦: <a href="https://www.xiaohongshu.com/user/profile/57d207127fc5b80a5ba8f181?xsec_token=ABV1YdZWooJGuigvNywrRlCN8Pu00zWLQwV21BWFv07Qk%3D&xsec_source=pc_search" target="_blank">Khalidåœ¨è·¯ä¸Š@å°çº¢ä¹¦</a> è·å–æ›´å¤šå¥½ç©çš„ä¸œè¥¿</p>
    <div class="contact-info">
        è”ç³»é‚®ç®±: <a href="mailto:ryan.zhang@pku.org.cn">ryan.zhang@pku.org.cn</a><br>
        <span style="opacity:0.6;">å£°æ˜ï¼šæœ¬å·¥å…·ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚</span>
    </div>
</div>

<script>
    let chartInstance = null;
    let currentTab = 'fv';
    let isProMode = false;
    let currentCPI = 0.5; 
    let currentCPILevel = 'low';
    let lastResult = { val: 0, realVal: 0, years: 10, inputs: {}, achTitle: "", achText: "" };

    const DEFAULTS = {
        pv: 100000, target_fv: 20000000, simple_pmt: 2000,
        income: 3000, expense: 1000, rate: 5, years: 15, inc_growth: 10, exp_growth: 3, cpi: 0.5
    };

    function safeGetEl(id) { return document.getElementById(id); }
    function getVal(id, defKey) { 
        const el = safeGetEl(id);
        if(!el) return DEFAULTS[defKey];
        return el.value === "" ? DEFAULTS[defKey] : parseFloat(el.value);
    }
    function getRawVal(id) { 
        const el = safeGetEl(id);
        if(!el) return DEFAULTS[id];
        return el.value === "" ? DEFAULTS[id] : el.value;
    }

    window.onload = function() {
        try { loadData(); } catch(e) { console.error(e); clearData(false); }
    };

    function setCPI(val, level) {
        currentCPI = val;
        currentCPILevel = level;
        document.querySelectorAll('.cpi-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('cpi' + level.charAt(0).toUpperCase() + level.slice(1)).classList.add('active');
        if (lastResult.val > 0 || lastResult.val < 0) { runCalculation(); }
    }

    function saveData() {
        try {
            const data = {
                pv: safeGetEl('pv').value, target_fv: safeGetEl('target_fv').value,
                simple_pmt: safeGetEl('simple_pmt').value, income: safeGetEl('income').value,
                expense: safeGetEl('expense').value, rate: safeGetEl('rate').value,
                years: safeGetEl('years').value, inc_growth: safeGetEl('inc_growth').value,
                exp_growth: safeGetEl('exp_growth').value, isProMode: isProMode,
                cpi: currentCPI, cpiLevel: currentCPILevel, events: []
            };
            const rows = document.querySelectorAll('.event-row');
            rows.forEach(row => {
                data.events.push({
                    y: row.querySelector('.event-year').value,
                    desc: row.querySelector('.event-desc').value,
                    amt: row.querySelector('.event-amount').value
                });
            });
            localStorage.setItem('wealth_sim_v32', JSON.stringify(data));
        } catch(e) {}
    }

    function loadData() {
        const saved = localStorage.getItem('wealth_sim_v32');
        if (!saved) { updateUI(); return; }
        
        const data = JSON.parse(saved);
        const fields = ['pv', 'target_fv', 'simple_pmt', 'income', 'expense', 'rate', 'years', 'inc_growth', 'exp_growth'];
        fields.forEach(id => {
            if(safeGetEl(id)) safeGetEl(id).value = data[id] || "";
        });

        if (data.isProMode) {
            isProMode = true;
            safeGetEl('appContainer').classList.add('pro-mode');
            safeGetEl('lite-placeholder').style.display = 'none';
        }
        
        if(data.cpi) {
            currentCPI = data.cpi;
            currentCPILevel = data.cpiLevel || 'low';
            setCPI(currentCPI, currentCPILevel);
        }
        
        if (data.events && data.events.length > 0) {
            data.events.forEach(e => addEventRow(e.y, e.desc, e.amt));
        }
        updateUI();
    }

    function clearData(ask=true) {
        if(ask && !confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) return;
        localStorage.removeItem('wealth_sim_v32');
        const inputs = document.querySelectorAll('input');
        inputs.forEach(i => i.value = "");
        document.getElementById('eventContainer').innerHTML = "";
        isProMode = false;
        safeGetEl('appContainer').classList.remove('pro-mode');
        setCPI(0.5, 'low');
        updateUI();
    }

    function toggleMode() {
        isProMode = !isProMode;
        const container = safeGetEl('appContainer');
        const ph = safeGetEl('lite-placeholder');
        if (isProMode) { container.classList.add('pro-mode'); ph.style.display = 'none'; } 
        else { container.classList.remove('pro-mode'); ph.style.display = 'flex'; }
        updateUI(); saveData();
    }

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelector(`.tab[data-target="${tab}"]`).classList.add('active');
        updateUI();
    }

    // === æ ¸å¿ƒé€»è¾‘ï¼šåŠ¨æ€ç±»å‹è½¬æ¢ ===
    function setAsTarget(el) {
        // 1. å˜æˆæ–‡æœ¬æ¡†ï¼Œå…è®¸æ˜¾ç¤ºä¸­æ–‡
        el.type = 'text'; 
        // 2. æ¸…ç©ºå€¼ï¼Œæ˜¾ç¤ºâ€œå¾…è®¡ç®—â€
        el.value = 'âœ¨ å¾…è®¡ç®—...'; 
        // 3. ç¦ç”¨äº¤äº’
        el.disabled = true;
        // 4. æ·»åŠ é«˜äº®æ ·å¼
        el.closest('.form-group').classList.add('target-highlight');
    }

    function setAsInput(el, defaultVal) {
        // 1. æ¢å¤ä¸ºæ•°å­—æ¡†ï¼ˆç§»åŠ¨ç«¯å¼¹æ•°å­—é”®ç›˜ï¼‰
        el.type = 'number';
        // 2. å¯ç”¨äº¤äº’
        el.disabled = false;
        // 3. ç§»é™¤é«˜äº®
        el.closest('.form-group').classList.remove('target-highlight');
        // 4. æ·»åŠ â€œè¯·è¾“å…¥â€æç¤º
        el.closest('.form-group').classList.add('input-needed');
        
        // 5. æ™ºèƒ½å›å¡«ï¼šå¦‚æœæ˜¯â€œå¾…è®¡ç®—â€æ–‡å­—æˆ–ç©ºï¼Œå¡«å›é»˜è®¤å€¼
        if (el.value === 'âœ¨ å¾…è®¡ç®—...' || el.value === '') {
            el.value = defaultVal; 
        }
    }

    function updateUI() {
        const els = {
            pv: safeGetEl('pv'), 
            fv: safeGetEl('target_fv'), 
            years: safeGetEl('years'),
            rate: safeGetEl('rate'),
            simple: safeGetEl('simple_pmt_box'), 
            pro: safeGetEl('pro_cashflow_box'),
            res: safeGetEl('grp_solved_pmt')
        };

        // 1. æ¸…ç†æ‰€æœ‰æ ‡è®°
        document.querySelectorAll('.form-group').forEach(el => {
            el.classList.remove('target-highlight', 'input-needed');
        });

        // 2. æ¨¡å¼åˆ‡æ¢å¯è§æ€§
        if (currentTab === 'pmt') {
            els.simple.style.display = 'none'; els.pro.style.display = 'none'; els.res.style.display = 'block';
            // ç®—æŠ•å…¥æ—¶ï¼Œâ€œå»ºè®®å­˜å…¥â€æ˜¯ç›®æ ‡
            setAsTarget(safeGetEl('solved_pmt'));
        } else {
            els.res.style.display = 'none';
            if (isProMode) { els.simple.style.display = 'none'; els.pro.style.display = 'block'; } 
            else { els.simple.style.display = 'block'; els.pro.style.display = 'none'; }
        }

        // 3. æ ¸å¿ƒï¼šæ ¹æ® Tab åˆ‡æ¢è¾“å…¥æ¡†èº«ä»½
        // æ°¸è¿œæ˜¯ Input çš„
        setAsInput(els.rate, DEFAULTS.rate);

        if (currentTab === 'fv') { 
            setAsTarget(els.fv); // ç›®æ ‡æ˜¯ FV
            setAsInput(els.pv, DEFAULTS.pv);
            setAsInput(els.years, DEFAULTS.years);
        } 
        else if (currentTab === 'pv') { 
            setAsTarget(els.pv); // ç›®æ ‡æ˜¯ PV
            setAsInput(els.fv, DEFAULTS.target_fv);
            setAsInput(els.years, DEFAULTS.years);
        } 
        else if (currentTab === 'years') { 
            setAsTarget(els.years); // ç›®æ ‡æ˜¯ Years
            setAsInput(els.pv, DEFAULTS.pv);
            setAsInput(els.fv, DEFAULTS.target_fv);
        } 
        else if (currentTab === 'pmt') {
            // ç®—æŠ•å…¥æ—¶ï¼ŒPV/FV/Years éƒ½æ˜¯è¾“å…¥
            setAsInput(els.pv, DEFAULTS.pv);
            setAsInput(els.fv, DEFAULTS.target_fv);
            setAsInput(els.years, DEFAULTS.years);
        }
        
        safeGetEl('achievementBox').style.display = 'none';
    }

    function addEventRow(y="", desc="", amt="") {
        const div = document.createElement('div');
        div.className = 'event-row';
        div.innerHTML = `
            <input type="number" class="event-year" placeholder="å¹´" value="${y}" style="width:50px" onchange="saveData()">
            <input type="text" class="event-desc" placeholder="æ”¶æ”¯è¯´æ˜" value="${desc}" style="flex:1" onchange="saveData()">
            <input type="number" class="event-amount" placeholder="é‡‘é¢(+/-)" value="${amt}" style="flex:1" onchange="saveData()">
            <button class="btn-del" onclick="this.parentElement.remove(); saveData()">Ã—</button>
        `;
        safeGetEl('eventContainer').appendChild(div);
    }

    function simulate(p) {
        let balance = p.pv;
        let labels = ['Start'];
        let dataNominal = [p.pv];
        let dataReal = [p.pv];
        
        let curInc = p.income, curExp = p.expense;
        let curNet = p.initNetPmt !== undefined ? p.initNetPmt : (curInc - curExp);

        for (let y = 1; y <= p.years; y++) {
            for (let m = 1; m <= 12; m++) {
                balance = balance * (1 + p.rate/12) + curNet;
            }
            if (p.usePro && p.events[y]) balance += p.events[y];
            if (p.usePro) {
                if (p.isSimplePmtMode) curNet = curNet * (1 + p.incGrowth);
                else {
                    curInc = curInc * (1 + p.incGrowth);
                    curExp = curExp * (1 + p.expGrowth);
                    curNet = curInc - curExp;
                }
            }
            let realValue = balance / Math.pow(1 + currentCPI/100, y);
            labels.push(y + 'å¹´');
            dataNominal.push(balance);
            dataReal.push(realValue);
        }
        return { finalBalance: balance, finalReal: dataReal[dataReal.length-1], labels: labels, dataNominal: dataNominal, dataReal: dataReal };
    }

    function runCalculation() {
        let events = {};
        if (isProMode) {
            document.querySelectorAll('.event-row').forEach(row => {
                const y = parseInt(row.querySelector('.event-year').value);
                const amt = parseFloat(row.querySelector('.event-amount').value);
                if (y && !isNaN(amt)) {
                    if (!events[y]) events[y] = 0;
                    events[y] += amt;
                }
            });
        }

        const rate = getVal('rate', 'rate') / 100;
        const incGrowth = getVal('inc_growth', 'inc_growth') / 100;
        const expGrowth = getVal('exp_growth', 'exp_growth') / 100;

        lastResult.inputs = {
            pv: getRawVal('pv'), rate: getRawVal('rate'), years: getRawVal('years'),
            pmt_desc: isProMode ? `æ”¶å…¥${getRawVal('income')}/æ”¯å‡º${getRawVal('expense')}` : `æœˆå­˜${getRawVal('simple_pmt')}`
        };

        if (currentTab === 'fv') {
            const pv = getVal('pv', 'pv'); const years = getVal('years', 'years');
            let income = 0, expense = 0, initNetPmt = 0;
            if (isProMode) { income = getVal('income', 'income'); expense = getVal('expense', 'expense'); }
            else { initNetPmt = getVal('simple_pmt', 'simple_pmt'); }

            const res = simulate({
                pv, rate, years, income, expense, initNetPmt: isProMode ? undefined : initNetPmt,
                incGrowth, expGrowth, events, usePro: isProMode
            });
            // ä¿®å¤ï¼šæ‰‹åŠ¨å¡«å›ç»“æœ
            safeGetEl('target_fv').value = parseInt(res.finalBalance).toLocaleString();
            
            showResult(res.finalBalance, res.finalReal, res.labels, res.dataNominal, res.dataReal, years, "æœŸæœ«æ€»èµ„äº§");
            updateAchievement(res.finalReal, years, pv);
        }
        else if (currentTab === 'pmt') {
            const pv = getVal('pv', 'pv'); const target = getVal('target_fv', 'target_fv'); const years = getVal('years', 'years');
            let low = -10000000, high = 10000000, sol = 0;
            for(let i=0; i<40; i++) {
                let mid = (low + high) / 2;
                let res = simulate({ pv, rate, years, initNetPmt: mid, incGrowth, expGrowth, events, usePro: isProMode, isSimplePmtMode: true });
                if (res.finalBalance < target) low = mid; else high = mid; sol = mid;
            }
            // ä¿®å¤ï¼šå¡«å›ç»“æœ
            safeGetEl('solved_pmt').value = Math.round(sol).toLocaleString();
            lastResult.inputs.pmt_desc = `å»ºè®®æœˆå­˜${Math.round(sol)}`;
            const finalRes = simulate({ pv, rate, years, initNetPmt: sol, incGrowth, expGrowth, events, usePro: isProMode, isSimplePmtMode: true });
            showResult(target, finalRes.finalReal, finalRes.labels, finalRes.dataNominal, finalRes.dataReal, years, "ç›®æ ‡è¾¾æˆ");
            updateAchievement(finalRes.finalReal, years, pv);
        }
        else if (currentTab === 'pv') {
            const target = getVal('target_fv', 'target_fv'); const years = getVal('years', 'years');
            let income = 0, expense = 0, initNetPmt = 0;
            if (isProMode) { income = getVal('income', 'income'); expense = getVal('expense', 'expense'); }
            else { initNetPmt = getVal('simple_pmt', 'simple_pmt'); }
            let low = -100000000, high = 100000000, sol = 0;
            for(let i=0; i<40; i++) {
                let mid = (low + high) / 2;
                let res = simulate({ pv: mid, rate, years, income, expense, initNetPmt: isProMode ? undefined : initNetPmt, incGrowth, expGrowth, events, usePro: isProMode });
                if (res.finalBalance < target) low = mid; else high = mid; sol = mid;
            }
            // ä¿®å¤ï¼šå¡«å›ç»“æœ
            safeGetEl('pv').value = Math.round(sol).toLocaleString();
            lastResult.inputs.pv = Math.round(sol);
            const finalRes = simulate({ pv: sol, rate, years, income, expense, initNetPmt: isProMode ? undefined : initNetPmt, incGrowth, expGrowth, events, usePro: isProMode });
            showResult(target, finalRes.finalReal, finalRes.labels, finalRes.dataNominal, finalRes.dataReal, years, "ç›®æ ‡è¾¾æˆ");
            updateAchievement(finalRes.finalReal, years, sol);
        }
        else if (currentTab === 'years') {
            const pv = getVal('pv', 'pv'); const target = getVal('target_fv', 'target_fv');
            let income = 0, expense = 0, initNetPmt = 0;
            if (isProMode) { income = getVal('income', 'income'); expense = getVal('expense', 'expense'); }
            else { initNetPmt = getVal('simple_pmt', 'simple_pmt'); }
            let y = 0, finalRes = null;
            for(y=1; y<=100; y++) {
                finalRes = simulate({ pv, rate, years: y, income, expense, initNetPmt: isProMode ? undefined : initNetPmt, incGrowth, expGrowth, events, usePro: isProMode });
                if (finalRes.finalBalance >= target) break;
            }
            // ä¿®å¤ï¼šå¡«å›ç»“æœ
            safeGetEl('years').value = y;
            lastResult.inputs.years = y;
            showResult(finalRes.finalBalance, finalRes.finalReal, finalRes.labels, finalRes.dataNominal, finalRes.dataReal, y, "æœ€ç»ˆè¾¾æˆ");
            updateAchievement(finalRes.finalReal, y, pv);
        }
        saveData();
    }

    function showResult(nominalVal, realVal, labels, dataNominal, dataReal, years, labelText) {
        lastResult.val = nominalVal;
        lastResult.realVal = realVal;
        lastResult.years = years;
        
        safeGetEl('resLabel1').innerText = labelText;
        safeGetEl('resValue1').innerText = parseInt(nominalVal).toLocaleString();
        safeGetEl('resValue2').innerText = parseInt(realVal).toLocaleString();

        try {
            const ctx = safeGetEl('simChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            const color = isProMode ? '#8b5cf6' : '#3b82f6';
            const bgColor = isProMode ? 'rgba(139, 92, 246, 0.1)' : 'rgba(59, 130, 246, 0.1)';

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'åä¹‰èµ„äº§ (è´¦é¢)', data: dataNominal,
                            borderColor: color, backgroundColor: bgColor,
                            borderWidth: 3, tension: 0.3, fill: true
                        },
                        {
                            label: 'å®é™…è´­ä¹°åŠ› (æŠ—é€šèƒ€)', data: dataReal,
                            borderColor: '#10b981', borderDash: [5,5],
                            borderWidth: 2, tension: 0.3, pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: true, position:'top', align:'end', labels:{boxWidth:10} } },
                    scales: { 
                        y: { ticks: { callback: function(value) { return (value/10000).toFixed(0) + 'ä¸‡'; } } },
                        x: { grid: { display: false } }
                    }
                }
            });
        } catch(e) {}
    }

    function updateAchievement(val, years) {
        const box = safeGetEl('achievementBox');
        box.style.display = 'block';
        let title = "", text = "";

        if (val < 0) {
            title = "ğŸ“‰ æ½œåŠ›è›°ä¼æœŸ"; text = "æš‚æ—¶çš„ç°é‡‘æµæ‰¿å‹ä¸ä»£è¡¨ç»ˆå±€ã€‚è¿™æ­£æ˜¯å®¡è§†è´¢åŠ¡ç»“æ„çš„å¥‘æœºï¼Œå»ºè®®ä¼˜åŒ–å¤§é¢æ”¯å‡ºï¼Œä½ æ‹¥æœ‰è§¦åº•åå¼¹çš„æ— é™å¯èƒ½ã€‚";
        } else if (val < 1000000) {
            title = "ğŸŒ± ç§¯å°‘æˆå¤š"; text = "æ¯ä¸€é¢—å‚å¤©å¤§æ ‘éƒ½å§‹äºå¾®æœ«ã€‚ä½ å·²ç»æˆ˜èƒœäº†æ¶ˆè´¹ä¸»ä¹‰ï¼Œæ˜¯é•¿æœŸä¸»ä¹‰çš„è·µè¡Œè€…ã€‚åšæŒä¸‹å»ï¼Œå¤åˆ©æ•ˆåº”ä¼šåœ¨ç¬¬7å¹´å·¦å³çˆ†å‘ã€‚";
        } else if (val < 3000000) {
            title = "âš“ï¸ äººç”Ÿå‹èˆ±çŸ³"; text = "è¿™ç¬”èµ„é‡‘æ˜¯ä½ åº”å¯¹ä¸ç¡®å®šæ€§çš„åº•æ°”ã€‚åœ¨å¤§éƒ¨åˆ†åŸå¸‚å·²è¶³å¤Ÿå®‰å±…ä¹ä¸šï¼Œåœ¨ä¸€çº¿åŸå¸‚ä¹Ÿæ˜¯åšå®çš„èµ·æ­¥ã€‚";
        } else if (val < 5000000) {
            title = "ğŸš€ åŒºåŸŸå°åº·"; text = "ä½ çš„èµ„äº§å·²è¶…è¶Šç»å¤§å¤šæ•°åŒé¾„äººã€‚è¿™ä¸ä»…æ˜¯ä¸€ä¸²æ•°å­—ï¼Œæ›´æ˜¯ä½ ä»å®¹åº”å¯¹ç”Ÿæ´»é£é™©çš„æŠ¤åŸæ²³ã€‚";
        } else if (val < 10000000) {
            title = "ğŸ° åšå®ä¸­äº§"; text = "æ— è®ºèº«å¤„ä½•åœ°ï¼Œä½ éƒ½æ‹¥æœ‰äº†æå¼ºçš„æŠ—é£é™©èƒ½åŠ›ã€‚åœ¨è¿™ä¸ªé‡çº§ï¼Œè¯·æ›´å¤šå…³æ³¨èµ„äº§é…ç½®ï¼Œè®©é’±ä¸ºä½ å·¥ä½œã€‚";
        } else if (val < 20000000) {
            title = "ğŸ’ é»„é‡‘è‡ªç”±"; text = "A8çº§èµ„äº§ï¼åœ¨ä¸€çº¿åŸå¸‚å±äºä¼˜è¶Šé˜¶å±‚ï¼Œåœ¨äºŒä¸‰çº¿åŸå¸‚å·²å®ç°è´¢åŠ¡è‡ªç”±ã€‚è¢«åŠ¨æ”¶å…¥å¯èƒ½å·²è¦†ç›–ç”Ÿæ´»å¼€æ”¯ã€‚";
        } else if (val < 50000000) {
            title = "ğŸŒŸ æˆ˜ç•¥çº§çªç ´"; text = "ä½ å·²æ‹¥æœ‰äº†å¯¹ç”Ÿæ´»çš„â€œæ‹’ç»æƒâ€ã€‚ç°åœ¨çš„é‡ç‚¹ä¸å†æ˜¯ç§¯ç´¯ï¼Œè€Œæ˜¯èµ„äº§ä¿å€¼ä¸å®¶æ—ä¼ æ‰¿ã€‚";
        } else {
            title = "ğŸŒŒ æ˜Ÿè¾°å¤§æµ·"; text = "å°ç›®æ ‡è¾¾æˆï¼åœ¨è¿™ä¸ªé‡çº§ï¼Œé‡‘é’±åªæ˜¯æ•°å­—ã€‚ä½ çš„å†³ç­–å°†å½±å“æ›´å¤šäººçš„å‘½è¿ã€‚";
        }

        safeGetEl('achTitle').innerText = title;
        safeGetEl('achText').innerText = text;
        lastResult.achTitle = title;
        lastResult.achText = text;
    }

    function copyReport() {
        if(!lastResult.val) { alert("è¯·å…ˆç‚¹å‡»ã€å¼€å§‹æ¨æ¼”ã€‘"); return; }
        
        let report = `ã€ğŸ† è´¢å¯Œè‡ªç”±æ¨æ¼”æˆ˜æŠ¥ã€‘\n`;
        report += `------------------------\n`;
        report += `è§£é”æˆå°±ï¼š${lastResult.achTitle}\n`;
        report += `æˆå°±è§£è¯»ï¼š${lastResult.achText}\n`;
        report += `------------------------\n`;
        report += `ğŸ¯ åä¹‰èµ„äº§: ${parseInt(lastResult.val).toLocaleString()} å…ƒ\n`;
        report += `ğŸŸ¢ å®é™…è´­ä¹°åŠ›: ${parseInt(lastResult.realVal).toLocaleString()} å…ƒ\n`;
        report += `â³ å†æ—¶: ${lastResult.years} å¹´\n`;
        report += `ğŸ’° åˆå§‹æœ¬é‡‘: ${lastResult.inputs.pv}\n`;
        report += `ğŸ“ˆ å¹´åŒ–æ”¶ç›Š: ${lastResult.inputs.rate}% (é€šèƒ€: ${currentCPI}%)\n`;
        report += `ğŸ“¥ æŠ•å…¥æ¨¡å¼: ${lastResult.inputs.pmt_desc}\n`;
        if(isProMode) report += `ğŸš€ æ¨¡å¼: Proä¸“å®¶ (å«åŠ¨æ€å¢é•¿/äººç”Ÿå¤§é¢æ”¶æ”¯)\n`;
        report += `\n(æ•°æ®ç”± Khalidåœ¨è·¯ä¸Š@å°çº¢ä¹¦ æä¾›æ”¯æŒ)\n`;
        report += `è”ç³»é‚®ç®±: ryan.zhang@pku.org.cn`;

        navigator.clipboard.writeText(report).then(() => {
            alert("âœ… è¯¦ç»†æˆ˜æŠ¥å·²å¤åˆ¶ï¼\nå¯ç›´æ¥ç²˜è´´åˆ†äº«ç»™æœ‹å‹ã€‚");
        }).catch(err => {
            const ta = document.createElement("textarea");
            ta.value = report;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            alert("âœ… è¯¦ç»†æˆ˜æŠ¥å·²å¤åˆ¶ï¼");
        });
    }
</script>
</body>
</html>
